---
import PostList from "../../components/post-list.astro";
import BaseLayout from "../../layouts/base-layout.astro";
import { getPosts } from "../../lib/posts";
import { getTagName, getUniqueTags } from "../../lib/tags";

export async function getStaticPaths() {
  const posts = Object.values(getPosts());

  return [...getUniqueTags()].map((tag) => {
    return {
      params: { tag },
      props: {
        frontmatter: { title: tag, description: "" },
        posts: posts.filter((post) => post.frontmatter.tags.includes(tag)),
      },
    };
  });
}

const { tag } = Astro.params;
const { posts, frontmatter } = Astro.props;

frontmatter.title = getTagName(tag);
---

<BaseLayout {...Astro.props}>
  <h1>{frontmatter.title}</h1>

  <PostList posts={posts} />
</BaseLayout>
